name: CI - Tests

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.11]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}

      - name: Cache pip
        uses: actions/cache@v4
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
          name: CI - Tests

          on:
            push:
              branches: [ master, main ]
            pull_request:
              branches: [ master, main ]
            workflow_dispatch: {}

          jobs:
            test:
              runs-on: ubuntu-latest
              strategy:
                matrix:
                  python-version: [3.11]
              steps:
                - name: Checkout repository
                  uses: actions/checkout@v4

                - name: Setup Python
                  uses: actions/setup-python@v4
                  with:
                    python-version: ${{ matrix.python-version }}

                - name: Cache pip
                  uses: actions/cache@v4
                  with:
                    path: ~/.cache/pip
                    key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
                    restore-keys: |
                      ${{ runner.os }}-pip-

                - name: Install dependencies
                  run: |
                    python -m pip install --upgrade pip
                    if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
                    pip install pytest

                - name: Run tests
                  run: |
                    pytest -q
